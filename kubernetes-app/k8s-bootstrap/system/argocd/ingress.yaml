# @format
# ArgoCD Traefik IngressRoute
#
# Exposes the ArgoCD UI + API at /argocd path via Traefik.
# ArgoCD server must have server.rootpath=/argocd and server.insecure=true
# set in argocd-cmd-params-cm for this to work correctly.
#
# Priority must be higher than the nextjs catch-all PathPrefix(/) route.
# Traefik v3 calculates default priority from rule length (~14 for `/`).
# We set 100 to guarantee ArgoCD wins the match.

apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: argocd-ingress
  namespace: argocd
  labels:
    app.kubernetes.io/part-of: argocd
spec:
  entryPoints:
    - web
  routes:
    - match: PathPrefix(`/argocd`)
      kind: Rule
      priority: 100
      services:
        - name: argocd-server
          port: 80
