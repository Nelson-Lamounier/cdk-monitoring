{
  "annotations": {
    "list": []
  },
  "description": "Deployment and infrastructure logs from CloudWatch — Lambda functions, API Gateway, ECS containers, and CDK custom resources",
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 1,
  "id": null,
  "links": [],
  "panels": [
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 0 },
      "id": 100,
      "title": "API Lambda Functions",
      "type": "row"
    },
    {
      "title": "Subscribe Lambda Logs",
      "description": "Subscription endpoint Lambda — email verification and notification flow",
      "type": "logs",
      "id": 1,
      "datasource": {
        "type": "cloudwatch",
        "uid": "cloudwatch"
      },
      "gridPos": { "h": 10, "w": 12, "x": 0, "y": 1 },
      "targets": [
        {
          "datasource": {
            "type": "cloudwatch",
            "uid": "cloudwatch"
          },
          "expression": "fields @timestamp, @message, @logStream\n| filter @message not like /START RequestId|END RequestId|REPORT RequestId/\n| sort @timestamp desc\n| limit 200",
          "id": "",
          "logGroups": [
            {
              "arn": "",
              "name": "/aws/lambda/nextjs-subscribe-$environment"
            }
          ],
          "namespace": "",
          "queryMode": "Logs",
          "refId": "A",
          "region": "default",
          "statsGroups": []
        }
      ],
      "options": {
        "showTime": true,
        "sortOrder": "Descending",
        "dedupStrategy": "none",
        "wrapLogMessage": true,
        "prettifyLogMessage": false,
        "enableLogDetails": true
      }
    },
    {
      "title": "Get Article Lambda Logs",
      "description": "Article detail API Lambda — DynamoDB reads and response formatting",
      "type": "logs",
      "id": 2,
      "datasource": {
        "type": "cloudwatch",
        "uid": "cloudwatch"
      },
      "gridPos": { "h": 10, "w": 12, "x": 12, "y": 1 },
      "targets": [
        {
          "datasource": {
            "type": "cloudwatch",
            "uid": "cloudwatch"
          },
          "expression": "fields @timestamp, @message, @logStream\n| filter @message not like /START RequestId|END RequestId|REPORT RequestId/\n| sort @timestamp desc\n| limit 200",
          "id": "",
          "logGroups": [
            {
              "arn": "",
              "name": "/aws/lambda/nextjs-get-article-$environment"
            }
          ],
          "namespace": "",
          "queryMode": "Logs",
          "refId": "A",
          "region": "default",
          "statsGroups": []
        }
      ],
      "options": {
        "showTime": true,
        "sortOrder": "Descending",
        "dedupStrategy": "none",
        "wrapLogMessage": true,
        "prettifyLogMessage": false,
        "enableLogDetails": true
      }
    },
    {
      "title": "Lambda Errors (All Functions)",
      "description": "Errors aggregated across all NextJS Lambda functions",
      "type": "timeseries",
      "id": 3,
      "datasource": {
        "type": "cloudwatch",
        "uid": "cloudwatch"
      },
      "gridPos": { "h": 8, "w": 24, "x": 0, "y": 11 },
      "targets": [
        {
          "datasource": {
            "type": "cloudwatch",
            "uid": "cloudwatch"
          },
          "expression": "filter @message like /ERROR|Error|error|Exception|Runtime\\.ImportModuleError|Task timed out/\n| stats count(*) as errors by bin(5m)",
          "id": "",
          "logGroups": [
            { "arn": "", "name": "/aws/lambda/nextjs-subscribe-$environment" },
            { "arn": "", "name": "/aws/lambda/nextjs-get-article-$environment" },
            { "arn": "", "name": "/aws/lambda/nextjs-list-articles-$environment" },
            { "arn": "", "name": "/aws/lambda/nextjs-verify-subscription-$environment" }
          ],
          "namespace": "",
          "queryMode": "Logs",
          "refId": "A",
          "region": "default",
          "statsGroups": []
        }
      ],
      "fieldConfig": {
        "defaults": {
          "color": { "fixedColor": "red", "mode": "fixed" },
          "custom": {
            "fillOpacity": 30,
            "lineWidth": 2,
            "pointSize": 5,
            "drawStyle": "bars"
          },
          "unit": "short",
          "displayName": "Errors"
        },
        "overrides": []
      }
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 19 },
      "id": 101,
      "title": "API Gateway",
      "type": "row"
    },
    {
      "title": "API Gateway Execution Logs",
      "description": "REST API request/response traces including integration latency and status codes",
      "type": "logs",
      "id": 4,
      "datasource": {
        "type": "cloudwatch",
        "uid": "cloudwatch"
      },
      "gridPos": { "h": 12, "w": 24, "x": 0, "y": 20 },
      "targets": [
        {
          "datasource": {
            "type": "cloudwatch",
            "uid": "cloudwatch"
          },
          "expression": "fields @timestamp, @message\n| sort @timestamp desc\n| limit 200",
          "id": "",
          "logGroups": [
            {
              "arn": "",
              "name": "API-Gateway-Execution-Logs_${apigw_id}/api"
            }
          ],
          "namespace": "",
          "queryMode": "Logs",
          "refId": "A",
          "region": "default",
          "statsGroups": []
        }
      ],
      "options": {
        "showTime": true,
        "sortOrder": "Descending",
        "dedupStrategy": "none",
        "wrapLogMessage": true,
        "prettifyLogMessage": false,
        "enableLogDetails": true
      }
    },
    {
      "collapsed": false,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 32 },
      "id": 102,
      "title": "ECS Application",
      "type": "row"
    },
    {
      "title": "Next.js Application Logs",
      "description": "Next.js server-side logs — SSR, ISR, API route execution, and runtime errors",
      "type": "logs",
      "id": 5,
      "datasource": {
        "type": "cloudwatch",
        "uid": "cloudwatch"
      },
      "gridPos": { "h": 12, "w": 24, "x": 0, "y": 33 },
      "targets": [
        {
          "datasource": {
            "type": "cloudwatch",
            "uid": "cloudwatch"
          },
          "expression": "fields @timestamp, @message, @logStream\n| sort @timestamp desc\n| limit 200",
          "id": "",
          "logGroups": [
            {
              "arn": "",
              "name": "/ecs/nextjs/nextjs-app-$environment"
            }
          ],
          "namespace": "",
          "queryMode": "Logs",
          "refId": "A",
          "region": "default",
          "statsGroups": []
        }
      ],
      "options": {
        "showTime": true,
        "sortOrder": "Descending",
        "dedupStrategy": "none",
        "wrapLogMessage": true,
        "prettifyLogMessage": false,
        "enableLogDetails": true
      }
    },
    {
      "title": "Promtail Sidecar Logs",
      "description": "Promtail log shipping status — verify logs are being forwarded to Loki",
      "type": "logs",
      "id": 6,
      "datasource": {
        "type": "cloudwatch",
        "uid": "cloudwatch"
      },
      "gridPos": { "h": 10, "w": 12, "x": 0, "y": 45 },
      "targets": [
        {
          "datasource": {
            "type": "cloudwatch",
            "uid": "cloudwatch"
          },
          "expression": "fields @timestamp, @message\n| sort @timestamp desc\n| limit 100",
          "id": "",
          "logGroups": [
            {
              "arn": "",
              "name": "/ecs/nextjs/promtail-$environment"
            }
          ],
          "namespace": "",
          "queryMode": "Logs",
          "refId": "A",
          "region": "default",
          "statsGroups": []
        }
      ],
      "options": {
        "showTime": true,
        "sortOrder": "Descending",
        "dedupStrategy": "none",
        "wrapLogMessage": true,
        "prettifyLogMessage": false,
        "enableLogDetails": true
      }
    },
    {
      "title": "Node Exporter Logs",
      "description": "Node Exporter daemon service logs for host metrics collection",
      "type": "logs",
      "id": 7,
      "datasource": {
        "type": "cloudwatch",
        "uid": "cloudwatch"
      },
      "gridPos": { "h": 10, "w": 12, "x": 12, "y": 45 },
      "targets": [
        {
          "datasource": {
            "type": "cloudwatch",
            "uid": "cloudwatch"
          },
          "expression": "fields @timestamp, @message\n| sort @timestamp desc\n| limit 100",
          "id": "",
          "logGroups": [
            {
              "arn": "",
              "name": "/ecs/nextjs/node-exporter-$environment"
            }
          ],
          "namespace": "",
          "queryMode": "Logs",
          "refId": "A",
          "region": "default",
          "statsGroups": []
        }
      ],
      "options": {
        "showTime": true,
        "sortOrder": "Descending",
        "dedupStrategy": "none",
        "wrapLogMessage": true,
        "prettifyLogMessage": false,
        "enableLogDetails": true
      }
    },
    {
      "collapsed": true,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 55 },
      "id": 103,
      "title": "CDK Custom Resource Lambdas (Deployment-Time)",
      "type": "row",
      "panels": [
        {
          "title": "CDK Custom Resource Logs (All)",
          "description": "Logs from CDK-generated Lambda functions that run during CloudFormation deployments — SSM parameter writers, S3 auto-delete, certificate validation, etc.",
          "type": "logs",
          "id": 8,
          "datasource": {
            "type": "cloudwatch",
            "uid": "cloudwatch"
          },
          "gridPos": { "h": 12, "w": 24, "x": 0, "y": 56 },
          "targets": [
            {
              "datasource": {
                "type": "cloudwatch",
                "uid": "cloudwatch"
              },
              "expression": "fields @timestamp, @message, @logStream\n| filter @message not like /START RequestId|END RequestId|REPORT RequestId/\n| sort @timestamp desc\n| limit 200",
              "id": "",
              "logGroups": [
                { "arn": "", "name": "/aws/lambda/nextjs-alb-acm-validation-$environment" }
              ],
              "namespace": "",
              "queryMode": "Logs",
              "refId": "A",
              "region": "default",
              "statsGroups": []
            }
          ],
          "options": {
            "showTime": true,
            "sortOrder": "Descending",
            "dedupStrategy": "none",
            "wrapLogMessage": true,
            "prettifyLogMessage": false,
            "enableLogDetails": true
          }
        }
      ]
    },
    {
      "collapsed": true,
      "gridPos": { "h": 1, "w": 24, "x": 0, "y": 56 },
      "id": 104,
      "title": "Monitoring Infrastructure",
      "type": "row",
      "panels": [
        {
          "title": "Monitoring EC2 Instance Logs",
          "description": "EC2 instance bootstrap and runtime logs",
          "type": "logs",
          "id": 9,
          "datasource": {
            "type": "cloudwatch",
            "uid": "cloudwatch"
          },
          "gridPos": { "h": 10, "w": 24, "x": 0, "y": 57 },
          "targets": [
            {
              "datasource": {
                "type": "cloudwatch",
                "uid": "cloudwatch"
              },
              "expression": "fields @timestamp, @message\n| sort @timestamp desc\n| limit 100",
              "id": "",
              "logGroups": [
                {
                  "arn": "",
                  "name": "/ec2/monitoring-$environment/instances"
                }
              ],
              "namespace": "",
              "queryMode": "Logs",
              "refId": "A",
              "region": "default",
              "statsGroups": []
            }
          ],
          "options": {
            "showTime": true,
            "sortOrder": "Descending",
            "dedupStrategy": "none",
            "wrapLogMessage": true,
            "prettifyLogMessage": false,
            "enableLogDetails": true
          }
        }
      ]
    }
  ],
  "schemaVersion": 39,
  "tags": ["cloudwatch", "deployment", "lambda", "api-gateway", "ecs"],
  "templating": {
    "list": [
      {
        "current": {
          "selected": true,
          "text": "production",
          "value": "production"
        },
        "hide": 0,
        "includeAll": false,
        "label": "Environment",
        "multi": false,
        "name": "environment",
        "options": [
          { "selected": false, "text": "development", "value": "development" },
          { "selected": false, "text": "staging", "value": "staging" },
          { "selected": true, "text": "production", "value": "production" }
        ],
        "query": "development,staging,production",
        "skipUrlSync": false,
        "type": "custom"
      },
      {
        "current": {
          "selected": false,
          "text": "3twd0za7of",
          "value": "3twd0za7of"
        },
        "description": "API Gateway REST API ID (changes per environment deployment)",
        "hide": 0,
        "label": "API Gateway ID",
        "name": "apigw_id",
        "options": [
          { "selected": true, "text": "3twd0za7of", "value": "3twd0za7of" }
        ],
        "query": "3twd0za7of",
        "skipUrlSync": false,
        "type": "textbox"
      }
    ]
  },
  "time": {
    "from": "now-3h",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "",
  "title": "Deployment & Infrastructure Logs",
  "uid": "deployment-logs",
  "version": 1
}
