# @format
# @description Sync K8s Bootstrap Scripts to Development
#
# Syncs k8s-bootstrap/ to S3 when bootstrap scripts change.
# Independent from CDK infra pipeline â€” no cdk deploy triggered.
#
# Prerequisites:
#   - Infra pipeline deployed (SSM parameter /k8s/development/scripts-bucket exists)

name: Sync K8s Bootstrap to Development

on:
  push:
    branches:
      - develop
      - feature/k3s-kubernetes-migration
    paths:
      - "k8s-bootstrap/**"
      - ".github/workflows/sync-k8s-bootstrap-dev.yml"
      - ".github/workflows/_sync-k8s-content.yml"
  workflow_dispatch:

permissions:
  id-token: write
  contents: read

concurrency:
  group: sync-k8s-bootstrap-development
  cancel-in-progress: true

jobs:
  sync:
    name: Sync Bootstrap to Dev
    uses: ./.github/workflows/_sync-k8s-content.yml
    with:
      environment: development
      cdk-environment: development
      content-type: bootstrap
      source-dir: ./k8s-bootstrap
      s3-prefix: k8s-bootstrap
      ssm-document: k8s-development-deploy-manifests
      association-name: k8s-dev-bootstrap-sync
    secrets: inherit
